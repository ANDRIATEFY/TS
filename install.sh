#!/data/data/com.termux/files/usr/bin/bash

clear
echo -e "\e[1;36müîß Installation des d√©pendances et outils n√©cessaires pour TS\e[0m"

# Fonction pour v√©rifier si un module Python est install√© (par pip, pas juste import)
pkg install python
is_pip_installed() {
    python3 -m pip show "$1" >/dev/null 2>&1
}
# Fonction pour rendre tous les scripts ex√©cutables dans le dossier du script
set_executable_rights() {
    local thisdir
    thisdir="$(dirname "$(realpath "$0")")"
    for f in "$thisdir"/*.sh "$thisdir"/*.py "$thisdir"/*.bin; do
        [ -e "$f" ] && chmod +x "$f"
    done
}

# Mise √† jour syst√®me
echo -e "\e[1;34m[‚Ä¢] Mise √† jour de Termux...\e[0m"
pkg update -y && pkg upgrade -y

# Installation des paquets syst√®me
echo -e "\e[1;34m[‚Ä¢] Installation des paquets Termux requis...\e[0m"
pkg install -y python git ncurses-utils libjpeg-turbo zlib sqlite rust

# Autorisation du stockage
echo -e "\e[1;34m[‚Ä¢] Autorisation de stockage...\e[0m"
termux-setup-storage

# Mise √† jour pip et installation de base
echo -e "\e[1;34m[‚Ä¢] Mise √† jour de pip et biblioth√®ques essentielles...\e[0m"
pip install --upgrade pip setuptools wheel filelock

# Liste des modules √† v√©rifier/installer
PIP_MODULES=(telethon requests rich termcolor pillow cryptography instagrapi instaloader)

# Installation conditionnelle des modules Python
for module in "${PIP_MODULES[@]}"; do
    echo -e "\e[1;34m[‚Ä¢] V√©rification du module : $module...\e[0m"
    if is_pip_installed "$module"; then
        echo -e "\e[1;32m[‚úì] $module d√©j√† install√©\e[0m"
    else
        echo -e "\e[1;33m[‚Üí] Installation de $module...\e[0m"
        pip install --upgrade "$module"
        if is_pip_installed "$module"; then
            echo -e "\e[1;32m[‚úì] $module install√© avec succ√®s\e[0m"
        else
            echo -e "\e[1;31m[‚úó] √âchec de l'installation de $module !\e[0m"
        fi
    fi
done

# Rendre tous les scripts/binaire du dossier courant ex√©cutables
set_executable_rights

clear
echo -e "\e[1;32m[‚úÖ] Installation compl√®te termin√©e ! Tous les scripts et binaires sont ex√©cutables dans ce dossier.\e[0m"

cd TS
python3 authorisation.py
./ts.bin
